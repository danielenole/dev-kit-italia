import { Meta, Story, Canvas, Controls, Description, Subtitle, Title } from '@storybook/addon-docs/blocks';
import * as Stories from './it-autocomplete.stories';

<Meta of={Stories} />

# Autocompletamento

<description>Elementi e stili per la creazione di input con autocompletamento</description>

## Cosa fa
Il componente `it-autocomplete` aiuta gli utenti a scegliere le risposte da un elenco fornito mentre digitano.
Implementa il pattern ARIA per combobox con autocompletamento, garantendo una piena accessibilità per tutti gli utenti,
inclusi quelli che utilizzano tecnologie assistive.

## Anteprima e attributi del componente
Modifica gli attributi nella tabella per personalizzare in tempo reale l'aspetto e il comportamento del componente.
Per vedere come cambia il codice, clicca su **Show code**.

<Canvas of={Stories.EsempioInterattivo} />
<Controls of={Stories.EsempioInterattivo} />

## Esempio di autocompletamento

Il completamento automatico è un componente che aiuta gli utenti a scegliere le risposte da un elenco fornito.
Il componente è stato creato seguendo le linee guida ARIA APG per garantire la massima accessibilità.

<Canvas of={Stories.EsempioBase} />

## Indicazioni generali

Il componente `it-autocomplete` supporta:
- **Navigazione da tastiera**: usa le frecce ↑/↓ per navigare tra le opzioni, Invio per selezionare, Esc per chiudere
- **Screen reader**: annunci automatici del numero di risultati e dell'opzione selezionata
- **Ricerca dinamica**: filtraggio in tempo reale dei risultati mentre l'utente digita
- **Ricerca asincrona**: supporto per caricamento dinamico dei dati da API o altre fonti

## Accessibilità

Il componente implementa il pattern [ARIA Combobox with List Autocomplete](https://www.w3.org/WAI/ARIA/apg/patterns/combobox/examples/combobox-autocomplete-list/)
che garantisce:
- Corretti attributi ARIA per la navigazione assistita
- Annunci vocali per screen reader
- Gestione completa da tastiera
- Focus management appropriato

## Testo segnaposto

Puoi abbinare al componente un testo segnaposto (placeholder) per fornire indicazioni sul tipo di contenuto atteso.

<Canvas of={Stories.Placeholder} />

## Testo di supporto

In caso di necessità, puoi utilizzare un ulteriore contenuto testuale sotto il campo, indicando nell'attributo `support-text`
il testo da visualizzare o usando lo slot `support-text`.

<Canvas of={Stories.TestoDiSupporto} />

## Campo obbligatorio

Per rendere il campo obbligatorio, aggiungi l'attributo `required`.

<Canvas of={Stories.CampoObbligatorio} />

## Lunghezza minima per i suggerimenti

L'opzione `min-length` impedisce la visualizzazione dei suggerimenti se vengono digitati meno di N caratteri.
Questo è particolarmente utile quando si lavora con grandi quantità di dati.

<Canvas of={Stories.ConMinLength} />

## Stato disabilitato

Aggiungi l'attributo `disabled` per impedire l'interazione con il campo.

<Canvas of={Stories.Disabilitato} />

## Etichetta nascosta

Se vuoi nascondere l'etichetta (ad esempio nei campi di ricerca), utilizza l'attributo `label-hidden`.

<Canvas of={Stories.LabelHidden} />

## Cambiare i valori dinamicamente

In questo esempio viene mostrato come popolare il componente con dati che cambiano a fronte di un altro input,
ad esempio il valore di un altro elemento di un form (come una select nell'esempio che segue).

<Canvas of={Stories.DatiDinamici} />

## Ricerca asincrona

È possibile passare come opzione `source` una funzione per filtrare i dati e popolare il componente dinamicamente.
La funzione riceve come parametri la query di ricerca e una callback per popolare i risultati.

{/* <Canvas of={Stories.RicercaAsincrona} /> */}

## Esempio Regioni e Comuni

Esempio di autocompletamento annidato dove la selezione di una regione popola dinamicamente l'elenco dei comuni.

<Canvas of={Stories.RegioniEComuni} />

## Gestione degli eventi

Il componente emette due eventi personalizzati:
- `it-autocomplete-change`: emesso quando cambia il valore del campo
- `it-autocomplete-select`: emesso quando viene selezionata un'opzione dalla lista

<Canvas of={Stories.GestioneEventi} />

## Opzioni

| Proprietà | Tipo | Default | Descrizione |
|-----------|------|---------|-------------|
| `source` | `Array \| Function` | `[]` | Sorgente di dati dell'autocomplete. Se è una funzione, gli argomenti sono: `(query: string, populateResults: Function)` |
| `id` | `string` | - | Id dell'elemento |
| `name` | `string` | - | Nome del campo di input, da utilizzare con un form |
| `min-length` | `number` | `0` | Numero minimo di caratteri prima di mostrare i suggerimenti |
| `default-value` | `string` | - | Valore di default inserito nell'input |
| `placeholder` | `string` | - | Testo segnaposto |
| `support-text` | `string` | - | Testo di supporto |
| `required` | `boolean` | `false` | Il campo sarà obbligatorio |
| `disabled` | `boolean` | `false` | Il campo sarà disabilitato |
| `label-hidden` | `boolean` | `false` | Nasconde visivamente l'etichetta |

## Eventi

| Nome | Dettagli | Descrizione |
|------|----------|-------------|
| `it-autocomplete-change` | `{ value: string }` | Emesso quando cambia il valore del campo |
| `it-autocomplete-select` | `{ value: string }` | Emesso quando viene selezionata un'opzione |

## Internazionalizzazione (i18n)

Il componente è internazionalizzabile. La configurazione per Bootstrap Italia è stata settata in italiano.
È possibile personalizzare le stringhe utilizzando l'[utility di internazionalizzazione](/docs/i18n-internazionalizzazione--documentazione).

```js
const translation = {
  "autocomplete": {
    "noResults": "Nessun risultato trovato",
    "statusNoResults": "Nessun risultato trovato",
    "statusSelectedOption": "{option} selezionato",
    "statusResults": "{length, plural, =0 {Nessun risultato trovato} one {# risultato disponibile} other {# risultati disponibili}}",
    "assistiveHint": "Quando i risultati di completamento automatico sono disponibili, utilizza le frecce su e giù per scorrere e premi invio per selezionare."
  }
}
```
