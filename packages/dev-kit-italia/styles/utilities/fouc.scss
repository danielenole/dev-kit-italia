@use 'sass:list';

:root {
  --it-fouc-bg: #ddd;
  --it-host-display: inline-block;
}

@keyframes fouc-shimmer {
  0% {
    background-position: -200% 0;
  }

  100% {
    background-position: 200% 0;
  }
}

@mixin it-shimmer(
  $tag,
  $height: null,
  $width: null,
  $attr: null,
  $border-radius: 0,
  $bg: null,
  $padding: null,
  $margin: null,
  $aspectRatio: null,
  $pseudo: null
) {
  @at-root {
    // costruzione selettore base
    $selector: if($pseudo, '#{$tag}:not(:defined)::#{$pseudo}', '#{$tag}:not(:defined)');
    $selector-def: if($pseudo, '#{$tag}:defined::#{$pseudo}', '#{$tag}:defined');

    #{$selector} {
      @if $pseudo {
        content: '';
      }

      // layout
      display: var(--it-host-display, inline-block);
      box-sizing: border-box;

      // look shimmer
      border-radius: $border-radius;
      animation: fouc-shimmer 1.5s linear infinite;
      background-color: if($bg != null, $bg, var(--it-fouc-bg));
      background-image: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%);
      background-repeat: no-repeat;
      background-size: 200% 100%;
      vertical-align: middle;

      // dimensioni condizionali
      @if $height != null {
        height: $height;
      }
      @if $width != null {
        width: $width;
      }
      @if $padding != null {
        padding: $padding;
      }
      @if $margin != null {
        margin: $margin;
      }
      @if $aspectRatio != null {
        aspect-ratio: $aspectRatio;
      }

      // pseudo-elemento per simulare larghezza testo attributo
      @if $attr != null and $width == null {
        &::after {
          display: inline-block;
          content: attr(#{$attr});
          font-family: var(--#{$prefix}font-sans);
          white-space: nowrap;
        }
      }
    }

    // rispetto preferenze ridotte: shimmer diventa statico
    @media (prefers-reduced-motion: reduce) {
      #{$selector} {
        animation: none;
        background-image: none;
      }
    }

    // quando l'elemento Ã¨ definito
    #{$selector-def} {
      animation: none !important;
      background-color: transparent !important;
      background-image: none !important;
    }
  }
}

$it-components: (
  'it-accordion-item': (),
  'it-avatar': (
    border-radius: 50%,
  ),
  'it-back-to-top': (
    border-radius: var(--#{$prefix}radius-circle, 100%),
    height: 56px,
    width: 56px,
  ),
  'it-button': (
    border-radius: var(--#{$prefix}btn-border-radius, 4px),
    height: 44.8px,
    padding: 0 1rem,
  ),
  'it-chip': (
    height: 27.5px,
    border-radius: 40px,
  ),
  'it-checkbox': (
    height: 20px,
    width: 20px,
  ),
  'it-dropdown': (
    border-radius: var(--#{$prefix}btn-border-radius, 4px),
    height: 48px,
    padding: 0 1rem,
    attr: 'label',
  ),
  'it-icon': (
    border-radius: 50%,
    height: 32px,
    width: 32px,
  ),
  'it-input': (
    height: 74px,
    padding: 1rem,
    margin: 0 0 var(--#{$prefix}spacing-m, 24px) 0,
  ),
  'it-radio': (
    pseudo: before,
    height: 20px,
    width: 20px,
    border-radius: 100%,
    margin: 0 0.5rem 0 0,
  ),
  'it-radio-group': (
    // height: 80px,
    bg: transparent,
  ),
  'it-select': (
    height: 74px,
    padding: 1rem,
    margin: 0 0 var(--#{$prefix}spacing-m, 24px) 0,
  ),
  'it-select[multiple]': (
    height: 161px,
  ),
  'it-rating': (
    // height: 28px,
    bg: transparent,
  ),
  'it-rating-item': (
    height: 24px,
    width: 24px,
    border-radius: 50%,
  ),
  'it-video': (
    height: auto,
    width: 100%,
    // Check the Heads up! section in the documentation
    // https://sass-lang.com/documentation/modules/list/#slash
    aspect-ratio: list.slash(16, 9),
  ),
  'it-collapse': (),
);

@each $tag, $params in $it-components {
  @include it-shimmer(
    $tag,
    map-get($params, height),
    if(map-has-key($params, width), map-get($params, width), null),
    if(map-has-key($params, attr), map-get($params, attr), null),
    if(map-has-key($params, border-radius), map-get($params, border-radius), 0),
    if(map-has-key($params, bg), map-get($params, bg), null),
    if(map-has-key($params, padding), map-get($params, padding), null),
    if(map-has-key($params, margin), map-get($params, margin), null),
    if(map-has-key($params, aspect-ratio), map-get($params, aspect-ratio), null),
    if(map-has-key($params, pseudo), map-get($params, pseudo), null)
  );
}
